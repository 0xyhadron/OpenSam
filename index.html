<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <style>
        body {
            background-color: #E6E6FA;
        }



        body {
            max-width: 12cm;
            margin: 0 auto;
            font-family: sans-serif;
        }

        h1,
        h2 {
            text-align: center;
        }

        p {
            text-align: center;
        }

        label,
        input {
            display: inline-block;
        }

        label {
            width: 30%
        }

        input {
            width: 60%
        }

        input[type="submit"] {
            width: 100%;
        }

        input[type="range"] {
            transform: rotate(180deg);
        }
    </style>
    <meta charset="UTF-8" />
    <title>openSAM</title>
    <script src="https://cdn.jsdelivr.net/npm/sam-js/dist/samjs.min.js"></script>
    <script>
        let sam = new SamJs({ speed: 72, pitch: 160, throat: 128, mouth: 128 });

        function talk() {
            var input = document.getElementById("coolInput").value;
            fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer sk-EshPyEDRzRMeTTkDz1ER9T3BlbkFJrKXMVIuMCTxcnzGRbjda'
                },
                body: JSON.stringify({
                    'model': 'gpt-3.5-turbo',
                    'messages': [
                        {

                            'role': 'user',
                            'content': input,
                        }
                    ]
                })
            }).then((response) => response.json())
                .then(data => {
                    console.log(data);
                    let message = data.choices[0].message.content;
                    sam.speak(message);
                    send(message);

                });
        }

    </script>

</head>



<body>



    <h1>Software Automatic Mouth</h1>


    <center>
        <img src="https://media3.giphy.com/media/l3q2LNVExEP0z9CrS/giphy.gif?cid=ecf05e477slxqe6q9zsgqaiq5dpcilo6bw2d3c2d78yupta9&ep=v1_gifs_search&rid=giphy.gif&ct=g"
            height="200" width="200">
        <p>
            “Forty-two,” said Deep Thought, with infinite majesty and calm.


        </p>
        <hr>
        <input id="coolInput" type="text" title="Input"></input>
        <button onclick="talk()">talk to SAM</button>
        <button id="connectButton">Connect</button>
    </center>

    <hr>
    <script>
        let port;
        const connectButton = document.querySelector('#connectButton');
        const sendButton = document.querySelector('#sendButton');
        const inputTextarea = document.querySelector('#inputTextarea');

        async function connect() {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            console.log('Connected to port:', port.getInfo());
        }

        async function send(tek) {
            const writer = port.writable.getWriter();
            const str = tek
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            await writer.write(data);
            //await writer.close();
        }

        connectButton.addEventListener('click', connect);
        sendButton.addEventListener('click', send);
    </script>
    <center><a href="https://www.instagram.com/oxyhadron/">@oxyhadron</a>
    </center>

</body>

</html>